<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_search">
            <field name="name">Manufacturing Order Search</field>
            <field name="model">mrp_famotain.manufacturing_order</field>
            <field name="arch" type="xml">
                <search string="Search Manufacturing Order">
                    <field name="name"/>
                    <field name="sales_order_id"/>
<!--                    <field name="product_order_id"/>-->
<!--                    <field name="product_id"/>-->
                    <field name="manufactured_by"/>
                    <field name="notes"/>
                    <separator/>
                    <group>
                        <filter string="Need Progress" name="need_progress"  domain="[('state', 'in', ['draft', 'approve'])]" />
                        <filter string="Open" name="open_manufacturing" domain="[('state', 'in', ['approve', 'ready', 'on_progress'])]"/>
                        <filter string="Fix" name="fix_manufacturing" domain="[('state', 'in', ['approve', 'ready', 'on_progress', 'done'])]"/>
                    </group>
                    <separator/>
                    <group>
                        <filter string="All" name="all"/>
                        <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                        <filter string="Approved" name="approve" domain="[('state','=','approve')]"/>
                        <filter string="Ready" name="ready" domain="[('state','=','ready')]"/>
                        <filter string="On Progress" name="on_progress" domain="[('state','=','on_progress')]"/>
                        <filter string="Done" name="done" domain="[('state','=','done')]"/>
                        <filter string="Cancelled" name="cancel" domain="[('state','=','cancel')]"/>
                    </group>
                    <separator/>
                    <group string="Group By">
<!--                        <filter string="Product" name="group_product" domain="[]" context="{'group_by':'product_id'}"/>-->
                        <filter string="Manufactured By" name="group_vendor" domain="[]" context="{'group_by':'manufactured_by'}"/>
<!--                        <filter string="Product Order" name="group_product_order" domain="[]" context="{'group_by':'product_order_id'}"/>-->
                        <filter string="State" name="group_state" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_tree">
            <field name="name">Manufacturing Order Tree</field>
            <field name="model">mrp_famotain.manufacturing_order</field>
            <field name="arch" type="xml">
                <tree
                        decoration-danger="state == 'approve'"
                        decoration-bf="state == 'ready'"
                        decoration-success="state=='on_progress' or state=='done'"
                        decoration-it="state == 'cancel'"
                >
                    <field name="deadline"/>
                    <field name="name"/>
                    <field name="product_qty"/>
<!--                    <field name="product_order_id"/>-->
<!--                    <field name="product_id"/>-->
                    <field name="currency_id" invisible="1"/>
                    <field name="unit_cost" groups="famotain.famotain_manager"/>
                    <field name="total_cost" sum="Total Cost" groups="famotain.famotain_manager"/>
                    <field name="gross_profit" sum="Total Profit" groups="famotain.famotain_manager"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_form">
            <field name="name">Manufacturing Order Form</field>
            <field name="model">mrp_famotain.manufacturing_order</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,approve,ready,on_progress,done"/>
                        <button string="Add Product Order" name="action_add_product_order" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ['draft', 'approve', 'ready'])]}"/>
                        <button string="Approve" name="action_approve" confirm="Are you sure you want to approve this order?" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
                        <button string="Set to ready" name="action_force_ready" confirm="Are you sure you want to set this order to ready?" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ['draft', 'approve'])]}"/>
                        <button string="Produce" name="action_on_progress" confirm="Are you sure you want to process this order?" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ['ready'])]}"/>
                        <button string="Done" name="action_done" confirm="Are you sure you want to process this order?" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ['on_progress'])]}"/>
                        <button string="Cancel" name="action_cancel" type="object" confirm="Are you sure you want to cancel this record?" attrs="{'invisible': [('state', 'not in', ['draft', 'approve'])]}"/>
                        <button string="Force Cancel" name="action_force_cancel" type="object" confirm="Are you sure you want to cancel this record?" attrs="{'invisible': [('state', 'in', ['cancel', 'draft', 'done'])]}" groups="famotain.famotain_manager"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="sales_order_id"/>
                                <field name="product_order_id"/>
                                <field name="deadline"/>
                                <field name="manufactured_by"/>
                            </group>
                            <group>
                                <field name="product_qty"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="product_unit_sales" groups="famotain.famotain_manager"/>
                                <field name="unit_production_cost"/>
                                <field name="unit_cost" groups="famotain.famotain_manager"/>
                                <field name="unit_profit" groups="famotain.famotain_manager"/>
                            </group>
                        </group>
                         <notebook>
                             <page string="Product Orders" name="product_orders">
                                <field name="product_order_ids"
                                       mode="tree,kanban"
                                       context="{'default_sales_order_id': sales_order_id}">
                                    <tree default_order="product_type desc" create="0" delete="0" edit="0">
                                        <field name="product_type" invisible="1"/>
                                        <field name="qty"/>
                                        <field name="product_id"/>
                                        <field name="fabric_color"/>
                                        <field name="is_customized"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="product_price"/>
                                        <field name="total" sum="Total"/>
                                        <field name="state"/>
                                        <button name="open_record" type="object" class="oe_highlight" icon="fa-asterisk text-success"/>
                                    </tree>
                                    <kanban class="o_kanban_mobile" quick_create="0" archivable="0">
                                        <field name="id"/>
                                        <field name="design_image_small"/>
                                        <field name="qty"/>
                                        <field name="product_id"/>
                                        <field name="fabric_color"/>
                                        <field name="product_price"/>
                                        <field name="total"/>
                                        <field name="currency_id"/>
                                        <field name="state"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                                    <div class="row mt4" style="align-items: center;">
                                                        <div class="col-2">
                                                            <div class="o_kanban_image">
                                                                <img alt="Avatar" t-att-src="kanban_image('sales__order.product_order', 'design_image_small', record.id.raw_value)"/>
                                                            </div>
                                                        </div>
                                                        <div class="col-10" style="padding-left:25px">
                                                            <div class="o_kanban_record_top">
                                                                <div class="o_kanban_record_headings">
                                                                    <strong class="o_kanban_record_title"><span><t t-esc="record.qty.value"/> - <t t-esc="record.product_id.value"/></span></strong>
                                                                </div>
                                                                <strong><field name="product_price" widget="monetary"/></strong>
                                                            </div>
                                                            <div class="text-muted o_kanban_record_subtitle">
                                                                <span>Desc: <t t-esc="record.fabric_color.value"/></span>
                                                            </div>
                                                            <div class="o_kanban_record_bottom">
                                                                <div class="oe_kanban_bottom_left text-muted">
                                                                    <span>Total: <field name="total" widget="monetary"/></span>
                                                                </div>
                                                                <div class="oe_kanban_bottom_right">
                                                                    <field name="state" widget="label_selection" options="{'classes': {'draft': 'warning', 'confirm': 'info', 'on_progress': 'info', 'sent': 'success', 'cancel': 'default'}}"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </page>
                            <page string="Bill of Materials">
                                <field name="bom_ids" context="{'default_manufacturing_order_id': id}">
                                    <tree editable="bottom"
                                        decoration-danger="state == 'approve'"
                                        decoration-bf="state == 'ready'"
                                        decoration-success="state=='done'"
                                        decoration-it="state == 'cancel'"
                                    >
                                        <field name="sequence" widget="handle"/>
                                        <field name="name"/>
                                        <field name="is_calculated" invisible="1"/>
                                        <field name="unit_qty" attrs="{'readonly': [('is_calculated', '=', True)]}"/>
                                        <field name="component_id" attrs="{'readonly': [('is_calculated', '=', True)]}"/>
                                        <field name="component_detail_id"/>
                                        <field name="component_vendor_id" groups="famotain.famotain_manager"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="unit_cost" groups="famotain.famotain_manager"/>
                                        <field name="cost" sum="Total Cost" string="Total Cost" groups="famotain.famotain_manager"/>
                                        <field name="state"/>
                                        <button name="open_record" type="object" class="oe_highlight" icon="fa-asterisk text-success"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="BoM Lines">
                                <field name="bom_line_ids">
                                    <tree editable="bottom" create="0">
                                        <field name="component_type" invisible="1"/>
                                        <field name="component_id"/>
                                        <field name="description"/>
                                        <field name="qty" required="1"/>
                                        <field name="width" attrs="{'readonly': [('component_type', 'in', ['accessories', 'webbing'])], 'required': [('component_type', 'not in', ['accessories', 'webbing'])]}"/>
                                        <field name="height" attrs="{'readonly': [('component_type', 'in', ['accessories', 'webbing'])], 'required': [('component_type', 'not in', ['accessories', 'webbing'])]}"/>
                                        <field name="length" attrs="{'readonly': [('component_type', 'in', ['fabric', 'print', 'accessories', 'embroidery'])], 'required': [('component_type', 'not in', ['fabric', 'print', 'accessories', 'embroidery'])]}"/>
                                        <button name="open_record" type="object" class="oe_highlight" icon="fa-asterisk text-success"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                        <group>
                            <group>
                                <field name="notes"/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" groups="famotain.famotain_manager">
                                <field name="material_cost"/>
                                <field name="production_cost"/>
                                <field name="total_cost" class="oe_subtotal_footer_separator"/>
                                <field name="net_sales"/>
                                <field name="gross_profit" class="oe_subtotal_footer_separator"/>
                            </group>
                        </group>
                        <div class="oe_chatter">
                            <field name="message_follower_ids" widget="mail_followers"/>
                            <field name="activity_ids" widget="mail_activity"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="mrp_famotain.add_product_order_wizard_form">
            <field name="name">Add Product Order</field>
            <field name="model">mrp_famotain.add_product_order_wizard</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <group>
                            <field name="sales_order_id"/>
                            <field name="product_order_id"/>
                        </group>
                        <group>
                            <field name="product_type"/>
                            <field name="product_id"/>
                            <field name="qty"/>
                            <field name="is_customized"/>
                            <field name="fabric_color"/>
                        </group>
                    </group>
                    <footer>
                        <button name="action_add" string="Add" type="object" class="oe_right oe_highlight"/>
                        <button string="Cancel" special="cancel" class="oe_right"/>
                    </footer>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_product_order_inherit_views">
            <field name="name">Manufacturing Order - Product Order Inherit</field>
            <field name="model">sales__order.product_order</field>
            <field name="inherit_id" ref="sales__order.product_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']"  position="before">
                    <button string="Produce" name="create_manufacturing_order" confirm="Are you sure you want to produce this order?" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'confirm', 'approve']), ('manufacturing_order_id', '!=', False)]}"/>
                    <button string="Force Produce" name="force_create_manufacturing_order" confirm="Are you sure you want to force produce this order?" type="object" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'confirm', 'approve']), ('manufacturing_order_id', '!=', False)]}" groups="famotain.famotain_manager"/>
                </xpath>
                <xpath expr="//field[@name='sales_order_id']"  position="after">
                    <field name="manufacturing_order_id" />
                </xpath>
            </field>
        </record>

         <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_product_inherit_views">
            <field name="name">Manufacturing Order - Product Inherit</field>
            <field name="model">famotain.product</field>
            <field name="inherit_id" ref="famotain.product_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='description']"  position="after">
                    <field name="production_cost" groups="famotain.famotain_manager"/>
                </xpath>
            </field>
        </record>

        <record id="act_manufacturing_orders_on_sales_order" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders</field>
            <field name="res_model">mrp_famotain.manufacturing_order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">
                {
                    'search_default_sales_order_id': active_id,
                }
            </field>
        </record>

        <record model="ir.ui.view" id="mrp_famotain.manufacturing_order_sales_order_inherit_views">
            <field name="name">Manufacturing Order - Sales Order Inherit</field>
            <field name="model">sales__order.sales__order</field>
            <field name="inherit_id" ref="sales__order.sales__order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[hasclass('oe_button_box')]"  position="inside">
                    <button name="%(mrp_famotain.act_manufacturing_orders_on_sales_order)d" type="action" class="oe_stat_button" string="Manufacturing" icon="fa-industry"/>
                </xpath>
                <xpath expr="//page[@name='invoice']" position="after">
                    <page string="Manufacturing Orders" name="manufacturing_order">
                        <field name="manufacturing_order_ids">
                            <tree create="0"
                                    decoration-danger="state == 'approve'"
                                    decoration-bf="state == 'ready'"
                                    decoration-success="state=='on_progress' or state=='done'"
                                    decoration-it="state == 'cancel'"
                            >
                                <field name="product_order_id"/>
                                <field name="name"/>
                                <field name="product_qty"/>
                                <field name="manufactured_by"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="unit_cost" groups="famotain.famotain_manager"/>
                                <field name="total_cost" sum="Total Cost" groups="famotain.famotain_manager"/>
                                <field name="gross_profit" sum="Total Profit" groups="famotain.famotain_manager"/>
                                <field name="state"/>
                                <button name="open_record" type="object" class="oe_highlight" icon="fa-asterisk text-success"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Bill of Materials">
                        <field name="bom_ids">
                            <tree default_order="product_order_id,sequence" editable="bottom" create="0" delete="0"
                                decoration-danger="state == 'approve'"
                                decoration-bf="state == 'ready'"
                                decoration-success="state=='done'"
                                decoration-it="state == 'cancel'"
                            >
                                <field name="sequence" invisible="1"/>
                                <field name="manufacturing_order_id" invisible="1"/>
                                <field name="product_order_id"/>
                                <field name="color_notes"/>
                                <field name="is_calculated" invisible="1"/>
                                <field name="unit_qty" attrs="{'readonly': [('is_calculated', '=', True)]}"/>
                                <field name="component_id" attrs="{'readonly': [('is_calculated', '=', True)]}"/>
                                <field name="component_detail_id"/>
                                <field name="component_vendor_id" groups="famotain.famotain_manager"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="unit_cost" groups="famotain.famotain_manager"/>
                                <field name="cost" sum="Total Cost" string="Total Cost" groups="famotain.famotain_manager"/>
                                <field name="state"/>
                                <button name="open_record" type="object" class="oe_highlight" icon="fa-asterisk text-success"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>
    </data>
</odoo>